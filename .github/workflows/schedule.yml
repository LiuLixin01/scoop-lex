- name: Run Crawler (PowerShell)
        shell: powershell
        run: |
          # === 修复 1: 强制开启 TLS 1.2 (解决 QQ 音乐连接中断问题) ===
          [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
          
          # === 核心配置区 ===
          $UserAgent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
          
          # 获取所有 json 文件
          $manifests = Get-ChildItem "bucket/*.json"
          $updatedCount = 0

          foreach ($manifest in $manifests) {
              Write-Host "Analyzing: $($manifest.BaseName)..." -NoNewline
              
              try {
                  # Scoop checkver 脚本路径
                  $checkverScript = "$env:USERPROFILE\scoop\apps\scoop\current\bin\checkver.ps1"
                  
                  # 调用 checkver
                  . $checkverScript -Dir "bucket" -App $manifest.BaseName -u
                  
                  # 检查文件是否真的变了
                  $gitStatus = git status --porcelain $manifest.FullName
                  if ($gitStatus) {
                      Write-Host " [UPDATED!]" -ForegroundColor Green
                      $updatedCount++
                  } else {
                      Write-Host " [No Change]" -ForegroundColor Gray
                  }
              } catch {
                  Write-Host " [ERROR]" -ForegroundColor Red
                  Write-Host $_.Exception.Message
              }
          }
          
          Write-Host "Total apps updated today: $updatedCount"
